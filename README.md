# RNode-Halow

## Реализованный функционал

На текущий момент реализовано следующее:
* Передача и прием широковещательных пакетов по LMAC WiFi Halow
* DHCP клиент или статический IP
* Статистика в реальном времени
* Выбор частоты, параметров модуляции
* TCP сервер
* Прошивка/обновление по OTA (незашифровано)
* Подтверждена работоспособность с rns и его надстройками - meshchat, columba
* LBT
* Ограничение airtime

Что на данный момент отсутсвует:
* Стабильность - проект на ранней стадии разработки
* RNS стек - устройство является просто TCP модемом
* Не реализована поддержка подключения по USB, SDIO
* LMAC стек остается загадкой, по хорошему избавиться от проприетарных либ

## Стандартные параметры

Частота 866-867 МГц (ширина канала 1МГц)

PHY WiFi - MCS0

Мощность - 17dBm

Порт TCP - 8001

## Прошивка

ВНИМАНИЕ! Перед прошивкой рекомендуется разобрать одно из устройств и снять дамп SPI флешки!



## Настройка Reticulum

Дастаточно в интерфейсы вписать конфиг KISS устройства.

Ip адресс можно узнать через DHCP сервер на роутере - устройство имеет hostname "RNode-Halow-XXXXXX", где XXXXXX - последние 3 байта MAC адреса

```
  [[RNode-Halow]]
    type = TCPClientInterface
    enabled = yes
    target_host = 192.168.XXX.XXX
    target_port = 8001
```

## Настройка Meshchat

Создать новый интерфейс типа "TCP Client Interface", ввести IP ноды в поле "Target Host", порт фиксированный 8001

## Для разработчиков

Для простого старта достаточно поставить Taixin CDK и открыть проект в папке "project". Весь необходимый инструментарий содержится в CDK.

Логи идут по UART (IO12, IO13) со скоростью 2'000'000 бод, т.к. логи блокирующие

Для полноценной отладки используется Blue Pill прошитая в CKLink. Чип обязательно должен быть STM32F103C8, C6 не подойдет + китайцы любят пихать отбраковку/клоны с неработающим USB.

Для простой отладки только через UART есть возможность подпаять USB напрямую к выводам IO12, IO13 и использовать утилиту flasher/csky-usb-flasher.exe (исходники пока не готовы к публикации), устройство при этом должно находиться в загрузчике (флешка должна быть забита FF), тогда через zadig поставить драйвер libusbK, прошивка будет грузиться сразу в ОЗУ. Да, UART назначен на те же пины что и USB, в загрузчике это USB, в прошивке UART, поэтому не втыкайте напрямую в USB порты.

Прошивка для OTA генерируется автоматически project/XXXXX.packed.bin после сборки проекта.
